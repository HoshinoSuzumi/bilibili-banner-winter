<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ» bili banner - winter (Jan 2021)</title>
    <link rel="stylesheet" href="assets/css/main.css">
</head>
<body>
<div class="banner">
    <div class="animated" style="transform: translateX(0);">
        <div class="layer" style="opacity: 0;">
            <img src="img/banner/001.jpg" alt="001"/>
        </div>
        <div class="layer" style="opacity: 1;">
            <img src="img/banner/002.jpg" alt="002"/>
        </div>
        <div class="layer" style="opacity: 0;">
            <video loop autoplay muted src="img/banner/003.webm"></video>
        </div>
    </div>
</div>
<script>
  let $;
  window.$ = $ = function (el) {
    // ä¸ªäººä¹ æƒ¯æŒ‰æ¡ä»¶æ›´æ”¹
    if (typeof el === "string") {
      const elList = document.getElementsByClassName(el)
      return elList.length > 1 ? elList : elList[0]
    } else {
      window.addEventListener('load', el)
    }
  }
  //
  $(function () {
    // è·å–å›¾å±‚
    const mainLayer = $('banner')
    const animatedLayer = $('animated')
    const [leftLayer, theLayer, rightLayer] = $('layer')
    // åˆå§‹åŒ–å˜é‡
    let countEnter = 0; // ç§»å…¥ä½ç½®
    const resistance = 110; // é˜»åŠ›
    const opacityDistance = 70; // é€æ˜çš„è·ç¦»
    // åˆå§‹åŒ–æ–¹æ³•
    const sizeLimit = (val, min = 0, max = 1) => Math.min(Math.max(val, min), max)
    const getWidth = () => ((leftLayer.offsetWidth - animatedLayer.offsetWidth) / 2)
    // å…‰æ ‡è¿›å…¥
    const onEnter = ({clientX}) => (countEnter = clientX)
    // å…‰æ ‡ç§»åŠ¨
    const onMove = ({clientX}) => {
      const differenceWidth = getWidth()
      let translateX = countEnter - clientX // å…‰æ ‡åç§»é‡
      // åç§»é‡é˜»åŠ›è®¡ç®—
      const resistanceOffset = ((translateX / resistance / 100))
      translateX *= translateX > 0 ? resistanceOffset : -resistanceOffset
      // Box ç›’å­åç§»
      animatedLayer.style.transform = `translateX(${sizeLimit(translateX, -differenceWidth, differenceWidth)}px)`
      // é€æ˜çš„è®¡ç®—
      const opacity = sizeLimit((translateX >= 0 ? translateX : -translateX) / opacityDistance)
      theLayer.style.opacity = (1 - opacity).toString()
      if (translateX >= 0) {
        leftLayer.style.opacity = opacity.toString()
      } else {
        rightLayer.style.opacity = opacity.toString()
      }
    }
    // å…‰æ ‡ç¦»å¼€ ~ è¿›å…¥cssåŠ¨ç”» ~ å…¨éƒ¨å‚æ•°é‡ç½®
    const onLeave = () => {
      animatedLayer.classList.add('css-animated')
      theLayer.style.opacity = '1'
      leftLayer.style.opacity = '0'
      rightLayer.style.opacity = '0'
      animatedLayer.style.transform = 'translateX(0)'
      setTimeout(function () {
        animatedLayer.classList.remove('css-animated')
      }, 300)
    }
    // ç»‘å®šæ–¹æ³•
    mainLayer.addEventListener('mousemove', onMove)
    mainLayer.addEventListener('mouseenter', onEnter)
    mainLayer.addEventListener('mouseleave', onLeave)
  })
</script>
</body>
</html>
